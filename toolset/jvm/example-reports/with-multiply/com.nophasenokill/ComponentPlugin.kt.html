<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ComponentPlugin.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">jacocoTest.exec</a> &gt; <a href="index.source.html" class="el_package">com.nophasenokill</a> &gt; <span class="el_source">ComponentPlugin.kt</span></div><h1>ComponentPlugin.kt</h1><pre class="source lang-java linenums">package com.nophasenokill

import com.gradle.develocity.agent.gradle.DevelocityPlugin
import org.gradle.api.Plugin
import org.gradle.api.initialization.Settings
import org.gradle.caching.http.HttpBuildCache
import org.gradle.kotlin.dsl.develocity
import java.io.File
import java.net.URI

<span class="nc" id="L11">class ComponentPlugin: Plugin&lt;Settings&gt; {</span>
    override fun apply(settings: Settings) {

<span class="nc" id="L14">        settings.run {</span>

<span class="nc" id="L16">            settings.pluginManagement.repositories.gradlePluginPortal()</span>
<span class="nc" id="L17">            settings.dependencyResolutionManagement.repositories.mavenCentral()</span>

<span class="nc" id="L19">            settings.plugins.apply(DevelocityPlugin::class.java)</span>

<span class="nc" id="L21">            println(&quot;Build cache hashcode from component plugin is: ${buildCache.hashCode()}&quot;)</span>
<span class="nc" id="L22">            println(&quot;Settings Build cache hashcode from component plugin is: ${settings.buildCache.hashCode()}&quot;)</span>


<span class="nc" id="L25">            settings.plugins.withType(DevelocityPlugin::class.java) {</span>
<span class="nc" id="L26">                settings.extensions.findByType(DevelocityPlugin::class.java).run {</span>

<span class="nc" id="L28">                        develocity.run {</span>
<span class="nc" id="L29">                            buildScan.run {</span>
<span class="nc" id="L30">                                uploadInBackground.set(false)</span>
<span class="nc" id="L31">                                termsOfUseUrl.set(&quot;https://gradle.com/terms-of-service&quot;)</span>
<span class="nc" id="L32">                                termsOfUseAgree.set(&quot;yes&quot;)</span>

                                /*
                                    If you try to abstract these strings to a 'val' outside gradleEnterprise lambda, you get errors
                                    such as below:

                                    4 problems were found storing the configuration cache.
                                    - Gradle runtime: cannot serialize Gradle script object references as these are not supported with the configuration cache.
                                      See https://docs.gradle.org/8.5/userguide/configuration_cache.html#config_cache:requirements:disallowed_types
                                        ...
                                        ...
                                 */
<span class="nc" id="L44">                                obfuscation.run {</span>
<span class="nc" id="L45">                                    username { &quot;OBFUSCATED_USERNAME&quot; }</span>
<span class="nc" id="L46">                                    ipAddresses { addresses -&gt; addresses.map { _ -&gt; &quot;OBFUSCATED_IP_ADDRESS&quot; } }</span>
<span class="nc" id="L47">                                    hostname { &quot;OBFUSCATED_HOSTNAME&quot; }</span>
<span class="nc" id="L48">                                }</span>
<span class="nc" id="L49">                            }</span>
<span class="nc" id="L50">                        }</span>

<span class="nc" id="L52">                        buildCache.run {</span>
<span class="nc" id="L53">                            local.run {</span>
<span class="nc" id="L54">                                isEnabled = true</span>
<span class="nc" id="L55">                            }</span>

<span class="nc" id="L57">                            remote(HttpBuildCache::class.java).run {</span>
<span class="nc" id="L58">                                isEnabled = true</span>
<span class="nc" id="L59">                                isPush = true</span>
<span class="nc" id="L60">                                isAllowUntrustedServer = true</span>
<span class="nc" id="L61">                                isAllowInsecureProtocol = true</span>
<span class="nc" id="L62">                                url = URI(&quot;http://localhost:5071/cache/&quot;)</span>
<span class="nc" id="L63">                                credentials.run {</span>
<span class="nc" id="L64">                                    username = &quot;tom&quot;</span>
<span class="nc" id="L65">                                    password = &quot;Password01!&quot; // used for showcase</span>
<span class="nc" id="L66">                                }</span>
<span class="nc" id="L67">                            }</span>
<span class="nc" id="L68">                        }</span>
<span class="nc" id="L69">                }</span>
<span class="nc" id="L70">            }</span>

            fun includeBuildsAndProjects(dir: File) {
<span class="nc" id="L73">                dir.walk().forEach { file -&gt;</span>
<span class="nc bnc" id="L74" title="All 4 branches missed.">                    if (file.isFile &amp;&amp; file.name == &quot;build.gradle.kts&quot;) {</span>
                        // Include any projects
<span class="nc" id="L76">                        val relativePath = file.parentFile.relativeTo(rootDir).path.replace(File.separator, &quot;:&quot;)</span>
<span class="nc" id="L77">                        include(relativePath)</span>
<span class="nc" id="L78">                        project(&quot;:$relativePath&quot;).projectDir = file.parentFile</span>
<span class="nc bnc" id="L79" title="All 4 branches missed.">                    } else if (file.isFile &amp;&amp; file.name == &quot;settings.gradle.kts&quot;) {</span>
                        // Include any builds
<span class="nc" id="L81">                        includeBuild(file.parentFile)</span>
                    }
<span class="nc" id="L83">                }</span>
<span class="nc" id="L84">            }</span>

<span class="nc" id="L86">            includeBuildsAndProjects(rootDir)</span>
<span class="nc" id="L87">            enableFeaturePreview(&quot;STABLE_CONFIGURATION_CACHE&quot;)</span>
<span class="nc" id="L88">            enableFeaturePreview(&quot;TYPESAFE_PROJECT_ACCESSORS&quot;)</span>
<span class="nc" id="L89">        }</span>
<span class="nc" id="L90">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>